name: Deploy Pipeline with SemVer Enforcement

on:
  push:
    branches:
      - main  # Deploys to Dev on push
    tags:
      - 'v*'  # Match all tags but validate using regex

jobs:
  deploy_dev:
    if: github.ref_type == 'branch' && github.ref_name == 'main'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
      - name: Deploy to Dev
        run: |
          echo "ðŸš€ Deploying latest commit to DEV"
          # Add Dev deployment commands here

  deploy_test:
    if: github.ref_type == 'tag' && github.ref_name =~ '^v[0-9]+\.[0-9]+\.[0-9]+-test$'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
      - name: Deploy to Test
        run: |
          echo "ðŸš€ Deploying ${{ github.ref_name }} to TEST"
          # Add Test deployment commands here

  deploy_prod:
    if: github.ref_type == 'tag' && github.ref_name =~ '^v[0-9]+\.[0-9]+\.[0-9]+$'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
      - name: Deploy to Prod
        run: |
          echo "ðŸš€ Deploying ${{ github.ref_name }} to PRODUCTION"
          # Add Prod deployment commands here
