name: Deploy with SemVer Enforcement

on:
  push:
    branches:
      - main  # Deploys to Dev on push
    tags:
      - 'v*'  # Matches all tags (vX.Y.Z, vX.Y.Z-test, etc.)

jobs:
  deploy_dev:
    if: github.ref == 'refs/heads/main'  # Only runs if pushing to main
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
      - name: Deploy to Dev
        run: |
          echo "ðŸš€ Deploying latest commit to DEV"
          echo "${{ vars.ENVIRONMENT }}"

  deploy_test:
    if: startsWith(github.ref, 'refs/tags/v') && contains(github.ref, '-test')
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
      - name: Deploy to Test
        run: |
          echo "ðŸš€ Deploying Test Version: ${{ github.ref_name }}"
          echo "using ${{ env.ENVIRONMENT }}"

  deploy_prod:
    if: startsWith(github.ref, 'refs/tags/v') && !contains(github.ref, '-test')
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
      - name: Deploy to Prod
        run: |
          echo "ðŸš€ Deploying Production Version: ${{ github.ref_name }}"
          echo "using ${{ env.ENVIRONMENT }}"
